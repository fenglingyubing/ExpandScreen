# 任务6.2.1（REL-001）Windows 发布包 - 完成报告

## 任务信息

- **任务ID**: REL-001
- **优先级**: P0
- **负责人**: Windows工程师1
- **状态**: ✅ 已完成
- **完成日期**: 2026-01-26

## 目标

为 ExpandScreen Windows 端提供可复用的 Release 构建与安装包打包流程，确保：

- Release 配置构建/发布可一键产出（`dotnet publish`）
- 安装包可构建（Inno Setup）
- 可选随包携带依赖（ADB/驱动产物）
- CI 使用正确的 .NET 版本并上传发布产物

## 实现内容

### 1) Release 构建与 staging

新增 PowerShell 脚本：`scripts/release/windows/Build-WindowsRelease.ps1`

- `dotnet publish` 生成 Windows `win-x64` 发布目录（默认去除调试符号：`DebugType=None` / `DebugSymbols=false`）
- 产物整理到 staging 目录：`artifacts/windows/stage`
  - `app/`：应用发布文件
  - `adb/`：可选 platform-tools
  - `driver/`：可选驱动构建产物

### 2) 安装包（Inno Setup）

新增 Inno Setup 脚本：`installer/ExpandScreen.iss`

- 从 `artifacts/windows/stage` 打包生成安装包
- 支持卸载、开始菜单快捷方式、可选桌面图标
- 输出默认目录：`installer/Output/`

### 3) CI 调整与发布产物上传

更新 GitHub Actions：`.github/workflows/build.yml`

- 使用 .NET 8（与项目 `net8.0*` 目标一致）
- 增加 `dotnet publish`（`win-x64`）并上传到 artifacts

### 4) 文档补齐

- 新增：`docs/developer/RELEASE.md`
- 补充入口：
  - `docs/developer/README.md`
  - `docs/DEVELOPMENT.md`
  - `README.md`

## 使用方式

### 生成发布目录（staging）

```powershell
./scripts/release/windows/Build-WindowsRelease.ps1 -Configuration Release -RuntimeIdentifier win-x64
```

输出：`artifacts/windows/stage`

### 生成安装包（需要 Inno Setup）

```powershell
./scripts/release/windows/Build-WindowsRelease.ps1 -BuildInstaller -AppVersion 0.1.0
```

输出：`installer/Output/ExpandScreen-Setup-0.1.0.exe`

### 可选：包含 ADB / 驱动产物

```powershell
./scripts/release/windows/Build-WindowsRelease.ps1 -IncludeAdb
./scripts/release/windows/Build-WindowsRelease.ps1 -DriverArtifactsDir "C:\path\to\driver\output"
```

> 备注：ADB（platform-tools）分发许可需自行确认合规；驱动产物需在 WDK 环境下构建/签名后提供目录。

## 构建/测试记录（本地 Windows）

- SDK：`8.0.417`
- 构建：`dotnet build ExpandScreen.sln -c Release`
  - 结果：成功（4 warnings，0 errors）
- 测试：`dotnet test ExpandScreen.sln -c Release --no-build --verbosity normal`
  - 结果：通过 50，跳过 9，失败 0（总计 59）
- 发布脚本：`./scripts/release/windows/Build-WindowsRelease.ps1 -Configuration Release -RuntimeIdentifier win-x64`
  - 结果：成功产出 `artifacts/windows/stage`

## 已知限制

- 驱动（`src/ExpandScreen.Driver`）仍需要 Windows + WDK 环境完成构建/签名；仓库不内置签名证书。
- FFmpeg native binaries 与 ADB binaries 默认不随仓库提交，安装包是否内置取决于发布策略与合规要求。

