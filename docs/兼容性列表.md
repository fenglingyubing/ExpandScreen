# 兼容性列表（设备矩阵 / 已知问题 / 解决方案）

本文档用于集中维护 ExpandScreen 的兼容性信息，目标是让“测试 → 记录 → 修复/回退 → 再验证”形成闭环，避免同类问题反复出现。

## 1. 如何留存兼容性信息（最小闭环）

1. 在目标环境启动 Windows 客户端
2. 打开：`设置 → 诊断`
3. 点击：
   - `复制兼容性摘要`（粘贴到本页“测试记录”表格的备注列/缺陷单）
   - `导出诊断包`（将 zip 作为附件留存）
4. 执行关键场景（连接/投屏/触控/重连/长稳），记录结果与问题现象

诊断包关键文件（best-effort）：
- `compatibility-summary.txt`
- `compatibility-info.json`

## 2. 已测试设备（建议模板）

### 2.1 Windows 环境

| 日期 | OS | 语言 | 缩放 | CPU/GPU | 编码器 | 分辨率@帧率 | 结果 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| - | - | - | - | - | Auto/NVENC/QSV/FFmpeg | - | PASS/FAIL | 贴 `兼容性摘要` 或链接 |

### 2.2 Android 设备

| 日期 | 品牌/型号 | Android | SoC/GPU | 分辨率 | 网络 | 结果 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| - | - | - | - | - | USB/WiFi | PASS/FAIL | 贴 `兼容性摘要` 或链接 |

## 3. 已知问题（持续维护）

| ID | 现象 | 触发条件 | 影响 | 临时规避 | 修复状态 |
| --- | --- | --- | --- | --- | --- |
| COMP-001 | 硬件编码器可探测但初始化失败 | 特定驱动/设备组合 | 无法启动会话或黑屏 | 让系统回退到软件编码；或手动选择 `FFmpeg` | ✅ 已加入回退机制 |
| COMP-002 | 高分辨率/高帧率初始化失败 | 2K/4K、90/120fps 等 | 会话建立失败 | 自动降低分辨率/帧率后重试 | ✅ 已加入回退机制 |
| COMP-003 | 虚拟显示驱动不可用 | 未安装/未签名/策略限制 | 无法创建虚拟屏 | 关闭虚拟显示或改用实体屏 | ⏳ 依赖环境 |

## 4. 解决方案与排查清单

### 4.1 硬件编码失败（NVENC / QuickSync）

- 现象：选择硬件编码后启动失败、日志提示 encoder init failed
- 处理：
  - 升级/重装显卡驱动
  - 使用 `设置 → 视频 → 编码器 = Auto` 或直接选择 `FFmpeg`
  - 附带诊断包（含兼容性摘要）提交缺陷单

### 4.2 高分辨率/高帧率失败

- 现象：2K/4K、90/120fps 建连或初始化失败
- 处理：
  - 将 `分辨率/帧率` 降到 `1080p@60` 或 `720p@60`
  - 若网络抖动明显，适当降低码率（参考推荐值）

